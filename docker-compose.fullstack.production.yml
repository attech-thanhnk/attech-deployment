# Production overrides - Auto-generated
services:
  backend:
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ConnectionStrings__Default=Data Source=sqlserver,1433;Initial Catalog=${DB_NAME};User ID=sa;Password=${SA_PASSWORD};Trust Server Certificate=True;
      # Domain configuration overrides (override appsettings.Production.json)
      - AppSettings__BaseUrl=https://attech.online
      - AdminUrl=https://admin.attech.online
      # CORS configuration
      - CorsOrigins__0=https://attech.online
      - CorsOrigins__1=https://www.attech.online
      - CorsOrigins__2=https://admin.attech.online
      # Email configuration (auto-generated from domain if not set in .env)
      - Contact__AdminEmails=admin@attech.online
      - Contact__ServiceDepartmentEmails=support@attech.online
      - Email__From=noreply@attech.online
      - Email__FromName=ATTECH
      - Company__SupportEmail=support@attech.online
      # SMTP configuration - ⚠️ SECURITY: Set via .env.production file!
      - Email__Smtp__Host=${SMTP_HOST:-smtp.gmail.com}
      - Email__Smtp__Port=${SMTP_PORT:-587}
      - Email__Smtp__EnableSsl=${SMTP_SSL:-true}
      - Email__Smtp__Username=${SMTP_USERNAME}
      - Email__Smtp__Password=${SMTP_PASSWORD}
    mem_limit: 1000m
    mem_reservation: 600m
    volumes:
      - ${UPLOADS_DIR}:/app/Uploads
      - ./logs:/app/Logs

  frontend:
    mem_limit: 150m
    mem_reservation: 100m

  sqlserver:
    environment:
      SA_PASSWORD: ${SA_PASSWORD}
      MSSQL_MEMORY_LIMIT_MB: 1024
    mem_limit: 1200m
    mem_reservation: 800m

  proxy:
    volumes:
      - ./nginx/proxy/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/proxy/conf.d/production.conf:/etc/nginx/conf.d/default.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
      - ${UPLOADS_DIR}:/var/www/uploads:ro
      - certbot_www:/var/www/certbot:ro

volumes:
  certbot_www:
    name: certbot_www
